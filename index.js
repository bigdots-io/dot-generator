"use strict";

var Fonts = {
  'system-micro': require('./fonts/system-micro'),
  'system-medium': require('./fonts/system-medium')
};

class TypeWriter {
  constructor(options) {
    options = options || {};
    this.font = options.font;
    this.column = options.startingColumn || 0;
    this.row = options.startingRow || 0;
    this.spaceBetweenLetters = options.spaceBetweenLetters || 1;
    this.alignment = options.alignment || 'left';
  }

  static availableFonts() {
    return Object.keys(Fonts);
  }

  getWidth(copy) {
    var font = Fonts[this.font],
        characters = font.characters,
        width = 0;

    for (let i = 0; i < copy.length; i++) {
      var character = characters[copy[i]];

      if(character) {
        width = width + parseInt(character.width || font.width, 10);
      }
    }

    return width;
  }

  text(copy, callback) {
    var font = Fonts[this.font],
        characters = font.characters;

    if(this.alignment === 'left') {
      for (let i = 0; i < copy.length; i++) {
        var character = characters[copy[i]];

        if(character) {
          var coordinates = character.coordinates;

          if(coordinates) {
            coordinates.forEach((point) => {
              callback({
                y: this.row + point.y,
                x: this.column + point.x
              });
            });

            var width = character.width || font.width;
            this.column = this.column + width + this.spaceBetweenLetters;
          }
        }
      }
    } else {
      this.column -= characters[copy[copy.length - 1]].width || font.width;
      for (let i = copy.length - 1; i >= 0; i--) {
        var character = characters[copy[i]];

        if(character) {
          var coordinates = character.coordinates;

          if(coordinates) {
            coordinates.forEach((point) => {
              callback({
                y: this.row + point.y,
                x: this.column + point.x
              });
            });

            var width = character.width || font.width;
            this.column = this.column - width - this.spaceBetweenLetters;
          }
        }
      }
    }
  }
}

module.exports = TypeWriter;
